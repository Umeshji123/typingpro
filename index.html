<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Typing Master: Fun typing test to boost speed & accuracy in multiple languages.">
  <meta name="keywords" content="typing test, typing master, typing speed, typing practice, online typing game, improve typing skills, typing tips, multi-language typing">
  <meta name="author" content="Typing Master Team">
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Typing Master - Test Your Typing Skills">
  <meta property="og:description" content="Improve your typing speed and accuracy in multiple languages with Typing Master, a fun and engaging typing test.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.typingmaster.example.com/">
  <meta property="og:image" content="https://www.typingmaster.example.com/images/typing-master-og.jpg">
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Typing Master - Test Your Typing Skills">
  <meta name="twitter:description" content="Improve your typing speed and accuracy in multiple languages with Typing Master, a fun and engaging typing test.">
  <meta name="twitter:image" content="https://www.typingmaster.example.com/images/typing-master-og.jpg">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans:ital,wght@0,400;0,700;1,400;1,700&family=Noto+Sans+Arabic:wght@400;700&family=Noto+Sans+Devanagari:wght@400;700&display=swap" rel="stylesheet">
  <title>Typing Master - Test Typing Speed</title>
  <style>
    body {
      font-family: 'Inter', 'Noto Sans', 'Noto Sans Arabic', 'Noto Sans Devanagari', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8fafc;
      text-align: center;
      line-height: 1.6;
      color: #1f2a44;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    body.dark-mode {
      background-color: #1a202c;
      color: #e2e8f0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: linear-gradient(145deg, #ffffff, #f1f5f9);
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      border: 1px solid #e2e8f0;
      box-sizing: border-box;
      transition: background 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark-mode .container {
      background: linear-gradient(145deg, #2d3748, #1a202c);
      border: 1px solid #4a5568;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #e2e8f0;
      margin-bottom: 20px;
      transition: border 0.3s ease;
    }
    body.dark-mode header {
      border-bottom: 1px solid #4a5568;
    }
    .header-actions {
      display: flex;
      align-items: center;
      gap: 20px;
    }
    .logo {
      font-size: 24px;
      font-weight: 700;
      color: #319795;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    body.dark-mode .logo {
      color: #81e6d9;
    }
    .logo:hover {
      color: #38b2ac;
    }
    nav {
      display: flex;
      gap: 20px;
    }
    nav a {
      font-size: 16px;
      font-weight: 500;
      color: #4a5568;
      text-decoration: none;
      transition: color 0.3s ease;
    }
    body.dark-mode nav a {
      color: #cbd5e0;
    }
    nav a:hover, nav a.active {
      color: #319795;
    }
    body.dark-mode nav a:hover, body.dark-mode nav a.active {
      color: #81e6d9;
    }
    h1 {
      color: #319795;
      font-size: 40px;
      font-weight: 700;
      margin-bottom: 16px;
      transition: color 0.3s ease;
    }
    body.dark-mode h1 {
      color: #81e6d9;
    }
    h2 {
      color: #319795;
      font-size: 28px;
      font-weight: 600;
      margin-top: 32px;
      transition: color 0.3s ease;
    }
    body.dark-mode h2 {
      color: #81e6d9;
    }
    h3 {
      color: #319795;
      font-size: 20px;
      font-weight: 600;
      margin-top: 24px;
      transition: color 0.3s ease;
    }
    body.dark-mode h3 {
      color: #81e6d9;
    }
    p, li {
      font-size: 16px;
      color: #4a5568;
      margin: 12px 0;
      transition: color 0.3s ease;
    }
    body.dark-mode p, body.dark-mode li {
      color: #cbd5e0;
    }
    ul {
      list-style: disc inside;
      text-align: left;
      padding: 0 20px;
    }
    #sample-text {
      background: #edf2f7;
      padding: 16px;
      margin: 24px 12px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      color: #1f2a44;
      box-sizing: border-box;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      text-align: left;
      transition: background 0.3s ease, color 0.3s ease, border 0.3s ease;
      direction: ltr;
    }
    body.dark-mode #sample-text {
      background: #2d3748;
      border: 1px solid #4a5568;
      color: #e2e8f0;
    }
    #sample-text.rtl {
      direction: rtl;
      text-align: right;
    }
    #sample-text .word {
      margin-right: 5px;
    }
    #sample-text.rtl .word {
      margin-right: 0;
      margin-left: 5px;
    }
    #sample-text .current {
      background-color: #81e6d9;
      color: #1f2a44;
      border-radius: 4px;
      padding: 2px 4px;
    }
    body.dark-mode #sample-text .current {
      background-color: #2c7a7b;
      color: #e2e8f0;
    }
    #sample-text .incorrect {
      background-color: #fed7d7;
      color: #1f2a44;
      border-radius: 4px;
      padding: 2px 4px;
    }
    body.dark-mode #sample-text .incorrect {
      background-color: #c53030;
      color: #e2e8f0;
    }
    #input-text {
      width: calc(100% - 24px);
      padding: 16px;
      margin: 8px 12px;
      font-size: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #ffffff;
      color: #1f2a44;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      box-sizing: border-box;
      transition: background 0.3s ease, color 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
      direction: ltr;
    }
    #input-text {
      height: 120px;
      resize: none;
    }
    #input-text.rtl {
      direction: rtl;
      text-align: right;
    }
    body.dark-mode #input-text {
      background: #2d3748;
      border: 1px solid #4a5568;
      color: #e2e8f0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    #input-text:focus {
      outline: none;
      border-color: #319795;
      box-shadow: 0 0 0 3px rgba(49, 151, 149, 0.2);
    }
    #start-btn, #reset-btn, #go-to-lesson-btn, #dark-mode-btn, #close-popup-btn, #submit-name-btn, #skip-name-btn, #change-name-btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      margin: 8px;
      cursor: pointer;
      background: #ed8936;
      color: #ffffff;
      border: none;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
    }
    #start-btn, #submit-name-btn, #change-name-btn {
      background: #319795;
      font-weight: 600;
    }
    body.dark-mode #start-btn, body.dark-mode #reset-btn, body.dark-mode #go-to-lesson-btn, body.dark-mode #dark-mode-btn, body.dark-mode #close-popup-btn, body.dark-mode #submit-name-btn, body.dark-mode #skip-name-btn, body.dark-mode #change-name-btn {
      background: #2c7a7b;
      color: #e2e8f0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    body.dark-mode #start-btn, body.dark-mode #submit-name-btn, body.dark-mode #change-name-btn {
      background: #2c7a7b;
    }
    #start-btn:hover, #reset-btn:hover, #go-to-lesson-btn:hover, #dark-mode-btn:hover, #close-popup-btn:hover, #submit-name-btn:hover, #skip-name-btn:hover, #change-name-btn:hover {
      background: #38b2ac;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    body.dark-mode #start-btn:hover, body.dark-mode #reset-btn:hover, body.dark-mode #go-to-lesson-btn:hover, body.dark-mode #dark-mode-btn:hover, body.dark-mode #close-popup-btn:hover, body.dark-mode #submit-name-btn:hover, body.dark-mode #skip-name-btn:hover, body.dark-mode #change-name-btn:hover {
      background: #319795;
    }
    #timer {
      font-size: 20px;
      font-weight: 600;
      color: #e53e3e;
      margin: 16px 0;
      transition: color 0.3s ease;
    }
    body.dark-mode #timer {
      color: #f687b3;
    }
    #progress-bar {
      width: calc(100% - 24px);
      height: 12px;
      margin: 16px auto;
      background: #edf2f7;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      overflow: hidden;
      transition: background 0.3s ease, border 0.3s ease;
    }
    body.dark-mode #progress-bar {
      background: #2d3748;
      border: 1px solid #4a5568;
    }
    #progress-bar-fill {
      height: 100%;
      background: linear-gradient(to right, #319795, #38b2ac);
      width: 100%;
      transition: width 0.3s ease;
    }
    body.dark-mode #progress-bar-fill {
      background: linear-gradient(to right, #2c7a7b, #319795);
    }
    #timer-select, #difficulty-select, #language-select {
      padding: 12px;
      font-size: 16px;
      margin: 8px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #ffffff;
      color: #1f2a44;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      box-sizing: border-box;
      transition: background 0.3s ease, color 0.3s ease, border 0.3s ease, box-shadow 0.3s ease;
    }
    body.dark-mode #timer-select, body.dark-mode #difficulty-select, body.dark-mode #language-select {
      background: #2d3748;
      border: 1px solid #4a5568;
      color: #e2e8f0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    #timer-select:focus, #difficulty-select:focus, #language-select:focus {
      outline: none;
      border-color: #319795;
      box-shadow: 0 0 0 3px rgba(49, 151, 149, 0.2);
    }
    #result {
      display: none;
    }
    .ad-placeholder {
      background: #edf2f7;
      padding: 16px;
      margin: 24px 12px;
      border: 1px dashed #e2e8f0;
      border-radius: 12px;
      color: #718096;
      box-sizing: border-box;
      transition: background 0.3s ease, color 0.3s ease, border 0.3s ease;
    }
    body.dark-mode .ad-placeholder {
      background: #2d3748;
      border: 1px dashed #4a5568;
      color: #a0aec0;
    }
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .popup-content {
      background: #ffffff;
      padding: 24px;
      border-radius: 16px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      transition: background 0.3s ease;
    }
    body.dark-mode .popup-content {
      background: #2d3748;
    }
    .popup-content h3 {
      margin-top: 0;
    }
    .popup-content p {
      font-size: 18px;
      font-weight: 500;
      color: #319795;
    }
    body.dark-mode .popup-content p {
      color: #81e6d9;
    }
    #name-popup-overlay {
      display: none;
    }
    #name-input {
      width: calc(100% - 24px);
      padding: 16px;
      margin: 12px auto;
      font-size: 16px;
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      background: #ffffff;
      color: #1f2a44;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      box-sizing: border-box;
      transition: all 0.3s ease;
    }
    body.dark-mode #name-input {
      background: #2d3748;
      border: 1px solid #4a5568;
      color: #e2e8f0;
    }
    #name-input:focus {
      outline: none;
      border-color: #319795;
      box-shadow: 0 0 0 3px rgba(49, 151, 149, 0.2);
    }
    #name-input::placeholder {
      color: #a0aec0;
      font-style: italic;
    }
    body.dark-mode #name-input::placeholder {
      color: #718096;
    }
    footer {
      margin-top: 48px;
      font-size: 14px;
      color: #4a5568;
      transition: color 0.3s ease;
    }
    body.dark-mode footer {
      color: #cbd5e0;
    }
    footer a {
      color: #319795;
      text-decoration: none;
      margin: 0 12px;
      transition: color 0.3s ease;
    }
    body.dark-mode footer a {
      color: #81e6d9;
    }
    footer a:hover {
      color: #38b2ac;
      text-decoration: underline;
    }
    @media (max-width: 600px) {
      .container {
        padding: 20px;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
      nav {
        flex-direction: column;
        gap: 10px;
        width: 100%;
        align-items: center;
      }
      h1 {
        font-size: 32px;
      }
      h2 {
        font-size: 24px;
      }
      h3 {
        font-size: 18px;
      }
      p, li {
        font-size: 14px;
      }
      #sample-text, #input-text, #result, .ad-placeholder {
        margin: 12px 8px;
      }
      #input-text {
        height: 100px;
        padding: 12px;
      }
      #start-btn, #reset-btn, #go-to-lesson-btn, #dark-mode-btn, #close-popup-btn, #submit-name-btn, #skip-name-btn, #change-name-btn, #timer-select, #difficulty-select, #language-select {
        padding: 10px 20px;
        font-size: 14px;
      }
      .popup-content {
        padding: 16px;
      }
      .popup-content p {
        font-size: 16px;
      }
    }
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
</head>
<body>
  <div class="container">
    <header>
      <a href="index.html" class="logo" aria-label="Typing Master Home">Typing Master</a>
      <div class="header-actions">
        <nav role="navigation" aria-label="Main navigation">
          <a href="/" class="active" aria-current="page">Home</a>
          <a href="tutorial.html">Tutorial</a>
          <a href="assets/main.html">Practice</a>
          <a href="lesson.html">Lesson</a>
          <a href="public/leaderboard.html">Leaderboard</a>
        </nav>
      </div>
    </header>
    <h1 id="main-heading">Typing Master</h1>
    <p>Test your typing speed and accuracy with Typing Master in your preferred language. Choose a language, difficulty, and start typing!</p>
    <div class="ad-placeholder">
      <p>AdSense Ad Placeholder (Insert your AdSense code here)</p>
    </div>
    <div id="timer" aria-live="polite">Time: 25 seconds</div>
    <div id="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="100">
      <div id="progress-bar-fill"></div>
    </div>
    <label for="language-select" class="sr-only">Select Language</label>
    <select id="language-select" aria-label="Select language">
      <option value="english" selected>English</option>
      <option value="spanish">Spanish</option>
      <option value="french">French</option>
      <option value="hindi">Hindi</option>
      <option value="arabic">Arabic</option>
    </select>
    <label for="difficulty-select" class="sr-only">Select Difficulty</label>
    <select id="difficulty-select" aria-label="Select difficulty level">
      <option value="easy">Easy</option>
      <option value="medium" selected>Medium</option>
      <option value="hard">Hard</option>
    </select>
    <label for="timer-select" class="sr-only">Select Timer</label>
    <select id="timer-select" aria-label="Select timer duration">
      <option value="15">15 seconds</option>
      <option value="25" selected>25 seconds</option>
      <option value="30">30 seconds</option>
      <option value="60">60 seconds</option>
    </select>
    <button id="dark-mode-btn" aria-label="Toggle dark mode" alt="Toggle dark or light mode">Toggle Dark Mode</button>
    <div id="sample-text" role="region" aria-label="Sample text to type"></div>
    <label for="input-text" class="sr-only">Type the sample text here</label>
    <textarea id="input-text" placeholder="Click 'Start' and type the text above..." aria-label="Typing input area"></textarea>
    <button id="start-btn" aria-label="Start typing test" alt="Begin the typing test">Start Test</button>
    <button id="reset-btn" style="display: none;" aria-label="Reset typing test" alt="Reset the typing test">Reset Test</button>
    <button id="go-to-lesson-btn" aria-label="Go to lesson" alt="Navigate to the lesson page">Go to Lesson</button>
    <button id="change-name-btn" aria-label="Change typist alias" alt="Change your typist alias">Change Alias</button>
    <div id="result" role="alert"></div>
    <div id="result-popup" class="popup-overlay" role="dialog" aria-labelledby="popup-title" aria-modal="true">
      <div class="popup-content">
        <h3 id="popup-title">Test Results</h3>
        <p id="popup-result"></p>
        <button id="close-popup-btn" aria-label="Close results popup" alt="Close the results popup">Close</button>
      </div>
    </div>
    <div id="name-popup-overlay" class="popup-overlay" role="dialog" aria-labelledby="name-popup-title" aria-modal="true">
      <div class="popup-content">
        <h3 id="name-popup-title">Welcome to Typing Master!</h3>
        <p>Enter your Typist Alias to join the leaderboard (optional)</p>
        <label for="name-input" class="sr-only">Enter your typist alias</label>
        <input type="text" id="name-input" placeholder="Craft your Typist Alias..." aria-label="Enter your typist alias for the leaderboard">
        <button id="submit-name-btn" aria-label="Submit typist alias" alt="Submit your typist alias">Submit</button>
        <button id="skip-name-btn" aria-label="Skip entering typist alias" alt="Skip entering a typist alias">Skip</button>
      </div>
    </div>
    <div id="typing-benefits">
      <h2>Why Improve Your Typing Skills?</h2>
      <p>Typing is a fundamental skill in today’s digital world. Enhancing your typing speed and accuracy can bring numerous benefits:</p>
      <ul>
        <li><strong>Boost Productivity:</strong> Type faster to complete tasks like emails, reports, or coding more efficiently, saving valuable time.</li>
        <li><strong>Enhance Communication:</strong> Quick and accurate typing improves online communication, whether you’re chatting, posting, or collaborating.</li>
        <li><strong>Career Advantage:</strong> Many jobs require proficient typing skills, from data entry to programming, giving you a competitive edge.</li>
        <li><strong>Reduce Fatigue:</strong> Proper typing techniques reduce strain, making long typing sessions more comfortable and sustainable.</li>
      </ul>
      <p>With Typing Master, you can practice regularly, track your progress, and turn typing into a fun, rewarding experience!</p>
    </div>
    <div id="typing-tips">
      <h2>Typing Tips for Beginners</h2>
      <p>Want to improve your typing skills? Here are some practical tips to get you started:</p>
      <ul>
        <li><strong>Learn Proper Hand Placement:</strong> Place your fingers on the home row (A-S-D-F for the left hand, J-K-L-; for the right hand) to build muscle memory.</li>
        <li><strong>Start Slow, Focus on Accuracy:</strong> Speed comes with practice, but accuracy is key. Avoid mistakes by typing deliberately at first.</li>
        <li><strong>Use All Fingers:</strong> Train yourself to use all fingers instead of just a few. This distributes the workload and increases efficiency.</li>
        <li><strong>Practice Regularly:</strong> Dedicate 10–15 minutes daily to typing practice. Consistency leads to steady improvement.</li>
        <li><strong>Take Breaks:</strong> Avoid strain by taking short breaks during long typing sessions to rest your hands and maintain focus.</li>
        <li><strong>Use Typing Master:</strong> Our game offers various difficulty levels, timers, and languages to help you practice effectively and track your progress.</li>
      </ul>
    </div>
    <footer>
      <p>© 2025 Typing Master. Crafted with love for typing enthusiasts.</p>
      <p>
        <a href="about.html" alt="Learn about Typing Master">About Us</a> |
        <a href="privacy.html" alt="View Typing Master Privacy Policy">Privacy Policy</a> |
        <a href="terms.html" alt="View Typing Master Terms of Service">Terms of Service</a> |
        <a href="contact.html" alt="Contact Typing Master Support">Contact</a>
      </p>
    </footer>
  </div>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Typing Master",
    "url": "https://www.typingmaster.example.com/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://www.typingmaster.example.com/search?q={search_term_string}",
      "query-input": "required name=search_term_string"
    },
    "description": "Typing Master offers a fun and engaging typing test to improve your typing speed and accuracy in multiple languages."
  }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const supabaseUrl = 'https://iornqvqinhzuytmzsosf.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlvcm5xdnFpbmh6dXl0bXpzb3NmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY2ODA1ODMsImV4cCI6MjA2MjI1NjU4M30.yddy734StH2-yiHHzNzarePftrdRgFZ2bvT4_6zLSS4';
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      const texts = {
        english: {
          easy: [
            "The gentle wind whispers through the ancient trees, carrying tales of forgotten spirits.",
            "A sparkling river dances over smooth stones, reflecting the golden light of dawn.",
            "In a quiet meadow, tiny creatures weave intricate stories under the glow of fireflies."
          ],
          medium: [
            "The gentle wind whispers through the ancient trees, carrying tales of forgotten spirits who once wandered these woods under a starlit sky.",
            "A sparkling river dances over smooth stones, reflecting the golden light of dawn in a quiet valley.",
            "In a quiet meadow, tiny creatures weave intricate stories under the soft glow of fireflies on a warm night."
          ],
          hard: [
            "The gentle wind whispers through the ancient trees, carrying tales of forgotten spirits who once wandered these woods under a starlit sky, their stories etched in the leaves.",
            "A sparkling river dances over smooth stones, reflecting the golden light of dawn in a quiet valley where time seems to stand still, inviting travelers to pause.",
            "In a quiet meadow, tiny creatures weave intricate stories under the soft glow of fireflies on a warm summer night, as the stars twinkle above, guiding dreamers."
          ]
        },
        spanish: {
          easy: [
            "El viento suave susurra entre los árboles antiguos, llevando cuentos de espíritus olvidados.",
            "Un río brillante baila sobre piedras lisas, reflejando la luz dorada del amanecer.",
            "En un prado tranquilo, pequeñas criaturas tejen historias bajo el brillo de las luciérnagas."
          ],
          medium: [
            "El viento suave susurra entre los árboles antiguos, llevando cuentos de espíritus olvidados que alguna vez vagaron por estos bosques bajo un cielo estrellado.",
            "Un río brillante baila sobre piedras lisas, reflejando la luz dorada del amanecer en un valle tranquilo.",
            "En un prado tranquilo, pequeñas criaturas tejen historias intrincadas bajo el suave brillo de las luciérnagas en una noche cálida."
          ],
          hard: [
            "El viento suave susurra entre los árboles antiguos, llevando cuentos de espíritus olvidados que alguna vez vagaron por estos bosques bajo un cielo estrellado, sus historias grabadas en las hojas.",
            "Un río brillante baila sobre piedras lisas, reflejando la luz dorada del amanecer en un valle tranquilo donde el tiempo parece detenerse, invitando a los viajeros a pausar.",
            "En un prado tranquilo, pequeñas criaturas tejen historias intrincadas bajo el suave brillo de las luciérnagas en una noche cálida de verano, mientras las estrellas titilan arriba, guiando a los soñadores."
          ]
        },
        french: {
          easy: [
            "Le vent doux murmure à travers les arbres anciens, portant des contes d'esprits oubliés.",
            "Une rivière scintillante danse sur des pierres lisses, reflétant la lumière dorée de l'aube.",
            "Dans une prairie tranquille, de petites créatures tissent des histoires sous l'éclat des lucioles."
          ],
          medium: [
            "Le vent doux murmure à travers les arbres anciens, portant des contes d'esprits oubliés qui erraient jadis dans ces bois sous un ciel étoilé.",
            "Une rivière scintillante danse sur des pierres lisses, reflétant la lumière dorée de l'aube dans une vallée paisible.",
            "Dans une prairie tranquille, de petites créatures tissent des histoires complexes sous la douce lueur des lucioles par une nuit chaude."
          ],
          hard: [
            "Le vent doux murmure à travers les arbres anciens, portant des contes d'esprits oubliés qui erraient jadis dans ces bois sous un ciel étoilé, leurs histoires gravées dans les feuilles.",
            "Une rivière scintillante danse sur des pierres lisses, reflétant la lumière dorée de l'aube dans une vallée paisible où le temps semble s'arrêter, invitant les voyageurs à faire une pause.",
            "Dans une prairie tranquille, de petites créatures tissent des histoires complexes sous la douce lueur des lucioles par une chaude nuit d'été, tandis que les étoiles scintillent au-dessus, guidant les rêveurs."
          ]
        },
        hindi: {
          easy: [
            "हल्की हवा प्राचीन पेड़ों के बीच फुसफुसाती है, भूले हुए आत्माओं की कहानियाँ लेकर।",
            "एक चमकती नदी चिकनी पत्थरों पर नाचती है, जो सुबह की सुनहरी रोशनी को प्रतिबिंबित करती है।",
            "एक शांत घास के मैदान में, छोटे जीव जुगनुओं की चमक के नीचे जटिल कहानियाँ बुनते हैं।"
          ],
          medium: [
            "हल्की हवा प्राचीन पेड़ों के बीच फुसफुसाती है, भूले हुए आत्माओं की कहानियाँ लेकर जो कभी तारों भरे आकाश के नीचे इन जंगलों में भटके थे।",
            "एक चमकती नदी चिकनी पत्थरों पर नाचती है, जो एक शांत घाटी में सुबह की सुनहरी रोशनी को प्रतिबिंबित करती है।",
            "एक शांत घास के मैदान में, छोटे जीव गर्म रात में जुगनुओं की नरम चमक के नीचे जटिल कहानियाँ बुनते हैं।"
          ],
          hard: [
            "हल्की हवा प्राचीन पेड़ों के बीच फुसफुसाती है, भूले हुए आत्माओं की कहानियाँ लेकर जो कभी तारों भरे आकाश के नीचे इन जंगलों में भटके थे, उनकी कहानियाँ पत्तियों में उकेरी गई हैं।",
            "एक चमकती नदी चिकनी पत्थरों पर नाचती है, जो एक शांत घाटी में सुबह की सुनहरी रोशनी को प्रतिबिंबित करती है, जहाँ समय रुक सा गया लगता है, यात्रियों को रुकने के लिए आमंत्रित करता है।",
            "एक शांत घास के मैदान में, छोटे जीव गर्म ग्रीष्मकालीन रात में जुगनुओं की नरम चमक के नीचे जटिल कहानियाँ बुनते हैं, जबकि तारे ऊपर टिमटिमाते हैं, सपने देखने वालों का मार्गदर्शन करते हैं।"
          ]
        },
        arabic: {
          easy: [
            "الريح اللطيفة تهمس عبر الأشجار القديمة، حاملة قصص الأرواح المنسية.",
            "نهر متلألئ يرقص فوق الحجارة الناعمة، يعكس ضوء الفجر الذهبي.",
            "في مرج هادئ، مخلوقات صغيرة تنسج قصصًا معقدة تحت وهج اليراعات."
          ],
          medium: [
            "الريح اللطيفة تهمس عبر الأشجار القديمة، حاملة قصص الأرواح المنسية التي كانت تتجول في هذه الغابات تحت سماء مرصعة بالنجوم.",
            "نهر متلألئ يرقص فوق الحجارة الناعمة، يعكس ضوء الفجر الذهبي في وادٍ هادئ.",
            "في مرج هادئ، مخلوقات صغيرة تنسج قصصًا معقدة تحت الوهج الناعم لليراعات في ليلة دافئة."
          ],
          hard: [
            "الريح اللطيفة تهمس عبر الأشجار القديمة، حاملة قصص الأرواح المنسية التي كانت تتجول في هذه الغابات تحت سماء مرصعة بالنجوم، قصصها محفورة في الأوراق.",
            "نهر متلألئ يرقص فوق الحجارة الناعمة، يعكس ضوء الفجر الذهبي في وادٍ هادئ حيث يبدو الزمن متوقفًا، يدعو المسافرين للتوقف.",
            "في مرج هادئ، مخلوقات صغيرة تنسج قصصًا معقدة تحت الوهج الناعم لليراعات في ليلة صيفية دافئة، بينما النجوم تتلألأ في الأعلى، تهدي الحالمين."
          ]
        }
      };
      let currentLanguage = 'english';
      let currentText = texts.english.medium[0];
      const sampleTextDiv = document.getElementById('sample-text');
      const inputText = document.getElementById('input-text');
      const startBtn = document.getElementById('start-btn');
      const resetBtn = document.getElementById('reset-btn');
      const goToLessonBtn = document.getElementById('go-to-lesson-btn');
      const darkModeBtn = document.getElementById('dark-mode-btn');
      const resultPopup = document.getElementById('result-popup');
      const popupResult = document.getElementById('popup-result');
      const closePopupBtn = document.getElementById('close-popup-btn');
      const timerDiv = document.getElementById('timer');
      const timerSelect = document.getElementById('timer-select');
      const difficultySelect = document.getElementById('difficulty-select');
      const languageSelect = document.getElementById('language-select');
      const progressBarFill = document.getElementById('progress-bar-fill');
      const namePopup = document.getElementById('name-popup-overlay');
      const nameInput = document.getElementById('name-input');
      const submitNameBtn = document.getElementById('submit-name-btn');
      const skipNameBtn = document.getElementById('skip-name-btn');
      const changeNameBtn = document.getElementById('change-name-btn');
      let startTime, timerInterval, timeLeft = 25, totalTime = 25;
      let totalKeystrokes = 0, incorrectWords = 0;
      let userAlias = '';
      const WORD_LENGTH = 5;

      function displayText(text) {
        try {
          const words = text.split(' ');
          sampleTextDiv.innerHTML = words.map((word, index) => `<span class="word" id="word-${index}">${word}</span>`).join(' ');
        } catch (e) {
          console.error('displayText error:', e);
        }
      }

      function updateLanguageDirection() {
        const isRtl = currentLanguage === 'arabic';
        sampleTextDiv.classList.toggle('rtl', isRtl);
        inputText.classList.toggle('rtl', isRtl);
      }

      displayText(currentText);
      updateLanguageDirection();

      async function saveHighScore(difficulty, wpm, accuracy) {
        try {
          const date = new Date().toLocaleString();
          const alias = localStorage.getItem('userAlias') || 'Anonymous';
          // Try inserting with language field
          let { data, error } = await supabase
            .from('scores')
            .insert([{ alias, difficulty, wpm, accuracy, date, language: currentLanguage }]);
          
          if (error) {
            console.error('Supabase insert error with language:', error.message, error.details, error.hint);
            // Fallback: Try inserting without language field
            const { data: fallbackData, error: fallbackError } = await supabase
              .from('scores')
              .insert([{ alias, difficulty, wpm, accuracy, date }]);
            if (fallbackError) {
              console.error('Supabase fallback insert error:', fallbackError.message, fallbackError.details, fallbackError.hint);
              showPopup('Failed to save score to leaderboard. Please check your connection or try again later.');
              return false;
            }
            console.log('Score saved successfully without language:', fallbackData);
            return true;
          }
          console.log('Score saved successfully:', data);
          return true;
        } catch (e) {
          console.error('saveHighScore unexpected error:', e);
          showPopup('Failed to save score due to an unexpected issue. Please try again.');
          return false;
        }
      }

      async function checkSupabaseConnection() {
        try {
          const { data, error } = await supabase.from('scores').select('id').limit(1);
          if (error) {
            console.error('Supabase connection test failed:', error.message, error.details, error.hint);
            showPopup('Unable to connect to the leaderboard database. Please try again later.');
            return false;
          }
          console.log('Supabase connection test successful:', data);
          return-true;
        } catch (e) {
          console.error('checkSupabaseConnection error:', e);
          showPopup('Unable to connect to the leaderboard database due to an unexpected issue.');
          return false;
        }
      }

      goToLessonBtn.addEventListener('click', () => {
        try {
          window.location.href = 'lesson.html';
        } catch (e) {
          console.error('goToLessonBtn error:', e);
        }
      });

      function loadTheme() {
        try {
          const savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            darkModeBtn.textContent = 'Toggle Light Mode';
          } else {
            document.body.classList.remove('dark-mode');
            darkModeBtn.textContent = 'Toggle Dark Mode';
          }
        } catch (e) {
          console.error('loadTheme error:', e);
        }
      }

      darkModeBtn.addEventListener('click', () => {
        try {
          document.body.classList.toggle('dark-mode');
          const isDarkMode = document.body.classList.contains('dark-mode');
          darkModeBtn.textContent = isDarkMode ? 'Toggle Light Mode' : 'Toggle Dark Mode';
          localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        } catch (e) {
          console.error('darkModeBtn error:', e);
        }
      });

      loadTheme();

      timerSelect.addEventListener('change', () => {
        try {
          timeLeft = parseInt(timerSelect.value);
          totalTime = timeLeft;
          timerDiv.textContent = `Time: ${timeLeft} seconds`;
          progressBarFill.style.width = '100%';
        } catch (e) {
          console.error('timerSelect error:', e);
        }
      });

      function getRandomText(language, difficulty) {
        const textPool = texts[language][difficulty];
        return textPool[Math.floor(Math.random() * textPool.length)];
      }

      difficultySelect.addEventListener('change', () => {
        try {
          currentText = getRandomText(currentLanguage, difficultySelect.value);
          displayText(currentText);
        } catch (e) {
          console.error('difficultySelect error:', e);
        }
      });

      languageSelect.addEventListener('change', () => {
        try {
          currentLanguage = languageSelect.value;
          currentText = getRandomText(currentLanguage, difficultySelect.value);
          displayText(currentText);
          updateLanguageDirection();
        } catch (e) {
          console.error('languageSelect error:', e);
        }
      });

      function debounce(func, wait) {
        let timeout;
        return function (...args) {
          clearTimeout(timeout);
          timeout = setTimeout(() => func.apply(this, args), wait);
        };
      }

      function showPopup(message) {
        popupResult.textContent = message;
        resultPopup.style.display = 'flex';
        closePopupBtn.focus();
      }

      closePopupBtn.addEventListener('click', () => {
        try {
          resultPopup.style.display = 'none';
          window.location.href = 'public/leaderboard.html';
        } catch (e) {
          console.error('closePopupBtn error:', e);
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && resultPopup.style.display === 'flex') {
          try {
            resultPopup.style.display = 'none';
            window.location.href = 'public/leaderboard.html';
          } catch (e) {
            console.error('resultPopup escape error:', e);
          }
        }
      });

      function showNamePopup() {
        try {
          namePopup.style.display = 'flex';
          nameInput.value = localStorage.getItem('userAlias') || '';
          nameInput.focus();
        } catch (e) {
          console.error('showNamePopup error:', e);
        }
      }

      function closeNamePopup() {
        try {
          namePopup.style.display = 'none';
          startBtn.disabled = false;
          console.log('Start button enabled:', startBtn.disabled);
          startBtn.focus();
        } catch (e) {
          console.error('closeNamePopup error:', e);
        }
      }

      function loadSavedAlias() {
        try {
          userAlias = localStorage.getItem('userAlias') || '';
          if (userAlias) {
            closeNamePopup();
          } else {
            showNamePopup();
          }
        } catch (e) {
          console.error('loadSavedAlias error:', e);
        }
      }

      submitNameBtn.addEventListener('click', () => {
        try {
          userAlias = nameInput.value.trim();
          localStorage.setItem('userAlias', userAlias);
          closeNamePopup();
        } catch (e) {
          console.error('submitNameBtn error:', e);
        }
      });

      skipNameBtn.addEventListener('click', () => {
        try {
          userAlias = '';
          localStorage.setItem('userAlias', '');
          closeNamePopup();
        } catch (e) {
          console.error('skipNameBtn error:', e);
        }
      });

      nameInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          try {
            userAlias = nameInput.value.trim();
            localStorage.setItem('userAlias', userAlias);
            closeNamePopup();
          } catch (e) {
            console.error('nameInput enter error:', e);
          }
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && namePopup.style.display === 'flex') {
          try {
            userAlias = '';
            localStorage.setItem('userAlias', '');
            closeNamePopup();
          } catch (e) {
            console.error('namePopup escape error:', e);
          }
        }
      });

      changeNameBtn.addEventListener('click', () => {
        try {
          showNamePopup();
        } catch (e) {
          console.error('changeNameBtn error:', e);
        }
      });

      function updateTimer() {
        try {
          timeLeft--;
          timerDiv.textContent = `Time: ${timeLeft} seconds`;
          const progress = (timeLeft / totalTime) * 100;
          progressBarFill.style.width = `${progress}%`;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            calculateResults();
          }
        } catch (e) {
          console.error('updateTimer error:', e);
        }
      }

      async function calculateResults() {
        try {
          inputText.disabled = true;
          startBtn.style.display = 'inline-block';
          resetBtn.style.display = 'none';
          timerSelect.disabled = false;
          difficultySelect.disabled = false;
          languageSelect.disabled = false;
          clearInterval(timerInterval);
          if (!inputText.value.trim()) {
            showPopup('No text entered. Try again!');
            return;
          }
          const timeTaken = (new Date() - startTime) / 1000;
          const timeInMinutes = timeTaken / 60;
          const grossWpm = totalKeystrokes > 0 ? (totalKeystrokes / WORD_LENGTH) / timeInMinutes : 0;
          const errorHits = incorrectWords * WORD_LENGTH;
          const netWpm = totalKeystrokes >= errorHits ? ((totalKeystrokes - errorHits) / WORD_LENGTH) / timeInMinutes : 0;
          const netHits = totalKeystrokes - errorHits;
          const accuracy = totalKeystrokes > 0 ? (netHits / totalKeystrokes) * 100 : 0;
          const message = `WPM: ${Math.round(netWpm)} | Accuracy: ${Math.round(accuracy)}% | Difficulty: ${difficultySelect.value} | Language: ${currentLanguage}`;
          const saved = await saveHighScore(difficultySelect.value, Math.round(netWpm), Math.round(accuracy));
          if (saved) {
            showPopup(`${message} `);
          } else {
            showPopup(`${message}\nFailed to save score to leaderboard, but your results are recorded locally.`);
          }
          inputText.removeEventListener('input', debouncedCheckTyping);
        } catch (e) {
          console.error('calculateResults error:', e);
          showPopup('An error occurred while calculating results. Please try again.');
        }
      }

      function checkTyping() {
        try {
          const typedText = inputText.value.trim();
          totalKeystrokes = inputText.value.length;
          const sampleWords = currentText.split(' ');
          const typedWords = typedText.split(' ').filter(word => word.length > 0);
          incorrectWords = 0;
          sampleTextDiv.querySelectorAll('.word').forEach(word => word.classList.remove('current', 'incorrect'));
          for (let i = 0; i < sampleWords.length; i++) {
            const wordElement = document.getElementById(`word-${i}`);
            if (i < typedWords.length) {
              if (typedWords[i] !== sampleWords[i]) {
                incorrectWords++;
                wordElement.classList.add('incorrect');
              }
            } else if (i === typedWords.length) {
              wordElement.classList.add('current');
            }
          }
          if (typedText === currentText) {
            clearInterval(timerInterval);
            calculateResults();
          }
        } catch (e) {
          console.error('checkTyping error:', e);
        }
      }

      const debouncedCheckTyping = debounce(checkTyping, 100);

      startBtn.addEventListener('click', async () => {
        console.log('Start button clicked');
        try {
          const isConnected = await checkSupabaseConnection();
          if (!isConnected) {
            showPopup('Cannot start test: Unable to connect to the leaderboard database.');
            return;
          }
          if (timerInterval) clearInterval(timerInterval);
          inputText.disabled = false;
          console.log('Textarea enabled:', inputText.disabled);
          inputText.focus();
          startBtn.style.display = 'none';
          resetBtn.style.display = 'inline-block';
          timerSelect.disabled = true;
          difficultySelect.disabled = true;
          languageSelect.disabled = true;
          inputText.value = '';
          resultPopup.style.display = 'none';
          startTime = new Date();
          totalKeystrokes = 0;
          incorrectWords = 0;
          timeLeft = parseInt(timerSelect.value);
          totalTime = timeLeft;
          timerDiv.textContent = `Time: ${timeLeft} seconds`;
          progressBarFill.style.width = '100%';
          timerInterval = setInterval(updateTimer, 1000);
          inputText.addEventListener('input', debouncedCheckTyping);
        } catch (e) {
          console.error('startBtn error:', e);
          showPopup('An error occurred while starting the test. Please try again.');
        }
      });

      resetBtn.addEventListener('click', () => {
        try {
          inputText.disabled = true;
          inputText.value = '';
          startBtn.style.display = 'inline-block';
          resetBtn.style.display = 'none';
          timerSelect.disabled = false;
          difficultySelect.disabled = false;
          languageSelect.disabled = false;
          resultPopup.style.display = 'none';
          if (timerInterval) clearInterval(timerInterval);
          timeLeft = parseInt(timerSelect.value);
          totalTime = timeLeft;
          timerDiv.textContent = `Time: ${timeLeft} seconds`;
          progressBarFill.style.width = '100%';
          currentText = getRandomText(currentLanguage, difficultySelect.value);
          displayText(currentText);
          totalKeystrokes = 0;
          incorrectWords = 0;
          inputText.removeEventListener('input', debouncedCheckTyping);
          sampleTextDiv.querySelectorAll('.word').forEach(word => word.classList.remove('current', 'incorrect'));
        } catch (e) {
          console.error('resetBtn error:', e);
        }
      });

      loadSavedAlias();
    });
  </script>
</body>
</html>
